

version: 2
jobs:
  convertToHtml:
      working_directory: /repo
      docker: 
        - image: asciidoctor/docker-asciidoctor
      steps:
        - run: mkdir -p workspace
        - run: echo "Hello, world!" > workspace/echo-output
        - persist_to_workspace:
            # Must be an absolute path, or relative path from working_directory. This is a directory on the container which is 
            # taken to be the root directory of the workspace.
            root: workspace
            # Must be relative path from root
            paths:
              - echo-output
  once:
    working_directory: /asciidoc
    docker: 
      - image: circleci/node:6
    steps:
      - attach_workspace:
          # Must be absolute path or relative path from working_directory
          at: /tmp/workspace

      - run: |
          if [[ `cat /tmp/workspace/echo-output` == "Hello, world!" ]]; then
            echo "It worked!";
          else
            echo "Nope!"; exit 1
          fi
  
workflows:
  version: 2
  build:
    jobs:
      - convertToHtml
      - once:
          requires:
            - convertToHtml
      